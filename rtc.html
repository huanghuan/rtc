<html>
<head>
<meta charset='UTF-8'>
<script src='https://cdn.webrtc-experiment.com:443/rmc3.min.js'></script>
<script src='https://cdn.webrtc-experiment.com:443/socket.io.js'></script>
<script src='https://cdn.webrtc-experiment.com/getScreenId.js'></script>
<script src='https://cdn.webrtc-experiment.com/screen.js'></script>
<script src='https://cdn.firebase.com/v0/firebase.js'></script>
<script src='https://cdn.bootcss.com/zepto/1.2.0/zepto.min.js'></script>
<style>
#d2 {
	display: none;
}
</style>
</head>
<body>
<div id='d1'>
<input id='room' placeholder='会议代码'>
<button id='join'>加入会议</button>
<button id='open'>创建会议</button>
</div>
<div id='d2'>
<button id='leave'>离开会议</button>
<button id='share'>分享桌面</button>
<select id='resolution'><option>960x720</option><option>640x480</option><option>320x240</option></select>
<span id='link'></span>
<button id='qrcode'>二维码</button>
</div>
<hr>
<script>
var connection = new RTCMultiConnection();
connection.socketURL = 'https://rtcmulticonnection.herokuapp.com:443/';
connection.session = {
	audio: true,
	video: true
};
connection.sdpConstraints.mandatory = {
	OfferToReceiveAudio: true,
	OfferToReceiveVideo: true
};
connection.onstream = function(event) {
	document.body.appendChild( event.mediaElement );
};

var hash = window.location.hash;
if (hash) {
	$('#room').val(hash.substring(1));
}
$('#open').click(function() {
	var roomId = Math.random() * 1000000 | 0;
	connected(roomId);
	$('#link').text('会议链接：' + window.location);
	connection.open(roomId);
});
$('#join').click(function() {
	var roomId = $('#room').val();
	connected(roomId);
	connection.join(roomId);
});
$('#leave').click(function() {
	connection.leave();
});
$('#resolution').change(function() {
	var v = $('#resolution').val();
	alert(v);
});
$('#qrcode').click(function() {
	$(this).replaceWith('<img src="https://api.qrserver.com/v1/create-qr-code/?size=128x128&data=' + encodeURI(window.location) + '">');
});
function connected(roomId) {
	window.location.hash = roomId;
	$('#d1').hide();
	$('#d2').show();
}

var screen = new Screen('screen-unique-id'); // argument is optional

// on getting local or remote streams
screen.onaddstream = function(e) {
	document.body.appendChild(e.video);
};

// check pre-shared screens
// it is useful to auto-view
// or search pre-shared screens
screen.check();
$('#share').click(function() {
	screen.share();
});
</script>
</body>
</html>
