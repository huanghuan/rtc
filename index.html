<html>
<head>
<meta name='viewport' content='width=device-width,initial-scale=1,user-scalable=0'>
<meta charset='UTF-8'>
<script src='https://simplewebrtc.com/latest-v2.js'></script>
<script src='https://cdn.bootcss.com/zepto/1.2.0/zepto.min.js'></script>
<style>
body {
	margin: 0;
	background: #06c url(bg.svg) no-repeat center;
	background-size: contain;
}
#videos {
	position: fixed;
	right: 16px;
	top: 16px;
}
video {
	display: block;
	width: 128px;
	height: auto;
}
.max {
	position: fixed;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
	object-fit: cover;
	z-index: -100;
}
header {
	position: fixed;
	left: 0;
	top: 16px;
	opacity: 0.8;
	transition: all 0.5s;
}
header.min {
	left: -192px;
}
header.min svg:not(:last-child) {
	opacity: 0;
}
header.min svg:last-child {
	transform: scaleX(-1);
}
svg {
	fill: none;
	stroke-width: 4px;
	margin-left: 16px;
	transition: all 0.5s;
	width: 32px;
	height: 32px;
}
header svg {
	stroke: #fff;
}
footer svg {
	stroke: #333;
	vertical-align: middle;
}
#shareScreen {
}
aside {
	background: #fff;
	display: flex;
	flex-direction: column;
	opacity: 1;
	transition: all 0.5s;
	position: fixed;
	left: 0;
	top: 0;
	bottom: 0;
	width: 25%;
}
aside.min {
	left: -25%;
	opacity: 0;
}
#messages {
	border-right: 4px solid #eee;
	flex: 1 1;
	padding: 8px;
}
footer {
	background: #eee;
	display: flex;
	flex: 0 0 auto;
	padding: 4px;
}
#text {
	border: 0;
	flex: 1 1;
	padding: 8px;
}
#file {
	display: none;
}
</style>
</head>
<body title='按F11键切换全屏'>
<div id='videos'>
<video id='localVideo'></video>
</div>
<header><svg viewBox="0 0 64 64" onclick='$("#text").focus();$("aside").removeClass("min");'>
	<polygon points="32,47 62,47 62,7 2,7 2,47 17,47 17,62"/>
</svg><svg id='shareScreen' viewBox="0 0 64 64"><title>共享屏幕</title>
	<rect x="2" y="7" width="60" height="40"/>
	<line x1="32" y1="47" x2="32" y2="62"/>
	<line x1="17" y1="62" x2="47" y2="62"/>
</svg><svg viewBox="0 0 64 64">
  <path d="m22,12a10,10 0 0 1 20,0l0,20a10,10 0 0 1 -20,0z"/>
  <path d="m12,32a20,20 0 0 0 40,0"/>
  <line x1="32" y1="52" x2="32" y2="62"/>
</svg><svg viewBox="0 0 64 64">
	<rect x="2" y="12" width="40" height="40"/>
	<polyline points="42,22 62,12 62,52 42,42"/>
</svg><svg viewBox="0 0 64 64" title='Show/hide toolbar' onclick='$("header").toggleClass("min")'>
	<polyline points="32,7 7,32 32,57"/>
	<line x1="7" y1="32" x2="57" y2="32"/>
</svg></header>
<aside class='min'><div id='messages'>
</div><footer><input id='text' type='text'><input id='file' type='file'>
<svg viewBox="0 0 64 64" title='发送消息' id='sendText'>
	<polygon points="32,47 62,47 62,7 2,7 2,47 17,47 17,62"/>
</svg>
<svg viewBox="0 0 64 64" title='发送文件' id='sendFile'>
	<polygon points="27,2 57,2 57,62 7,62 7,22"/>
	<polyline points="27,2 27,22 7,22"/>
</svg>
<svg viewBox="0 0 64 64" title='隐藏消息窗口' onclick='$("aside").addClass("min")'>
	<polyline points="32,7 7,32 32,57"/>
	<line x1="7" y1="32" x2="57" y2="32"/>
</svg>
</footer></aside>
<script>
var videos = document.querySelector('#videos');
var rtc = new SimpleWebRTC({
	autoRemoveVideos: false,
	autoRequestMedia: true,
	localVideoEl: 'localVideo'
});
$('#shareScreen').click(function() {
	try {
		rtc.shareScreen();
	} catch (err) {
		if (confirm('请先下载并安装浏览器插件'))
			location = '屏幕共享.zip';
	}
});
$('#sendText').click(function() {
	try {
		rtc.shareScreen();
	} catch (err) {
		if (confirm('请先下载并安装浏览器插件'))
			location = '屏幕共享.zip';
	}
});
$('#sendFile').click(function() {
	try {
		rtc.shareScreen();
	} catch (err) {
		if (confirm('请先下载并安装浏览器插件'))
			location = '屏幕共享.zip';
	}
});
rtc.on('readyToCall', function() {
	rtc.joinRoom('79');
}).on('videoAdded', function(video) {
	videos.appendChild(video);
	$(video).click();
}).on('videoRemoved', function(video) {
	videos.removeChild(video);
}).on('localScreenAdded', function(video) {
	$('#shareScreen').hide();
	videos.appendChild(video);
}).on('localScreenStopped', function(video) {
	$('#shareScreen').show();
});
rtc.connection.on('message', function(e) {
	if (e.type == 'text') {
		$('#messages').append(`<p>${e.payload}</p>`);
		$('aside').removeClass('min');
	}
});
$(document).on('click', 'video', function(e) {
	$('.max').removeClass('max');
	$(e.target).addClass('max');
});
$(document).on('click', 'svg', function(e) {
	var id = e.target.id;
	if (id && handlers[id])
		handlers[id]();
});
var handlers = {
	sendText() {
		var t = $('#text')[0], s = t.value;
		if (s.length) {
			rtc.sendToAll('text', s);
			t.value = '';
		}
		else {
			t.focus();
		}
	},
	sendFile() {
		$("#file").click();
	}
}
</script>
</body>
</html>
